# --- Basic image & service ---
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop: [ "ALL" ]
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000

podSecurityContext:
  fsGroup: 1000
  fsGroupChangePolicy: OnRootMismatch

extraInitContainers:
  - name: volume-permissions
    image: busybox:1.36
    command: [ "sh", "-c", "chown -R 1000:1000 /home/node/.n8n" ]
    securityContext:
      runAsUser: 0
    volumeMounts:
      - name: n8n-main-data
        mountPath: /home/node/.n8n

image:
  repository: n8nio/n8n
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 5678
  name: http

ingress:
  enabled: false

nodes:
  builtin:
    enabled: true

main:
  persistence:
    enabled: true
    volumeName: "n8n-main-data"
    mountPath: "/home/node/.n8n"
    size: 5Gi
    accessMode: ReadWriteMany
    storageClass: standard
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

db:
  type: postgresdb

externalPostgresql:
  host: postgresql-service.dev-db.svc.cluster.local
  port: 5432
  database: n8n_dev
  username: n8n_dev
  password: n8n-dev-password

externalRedis:
  host: redis-service.dev-db.svc.cluster.local
  port: 6379
  username: default
  password: redis-secret

# --- Queue mode (minimal) ---
worker:
  mode: queue
  count: 1
  concurrency: 5

webhook:
  mode: queue
  count: 1
  url: "http://n8n.192-168-58-2.sslip.io:30080"

encryptionKey: "DEV_ENCRYPTION_KEY_32_CHARS_1234"

diagnostics:
  enabled: false
