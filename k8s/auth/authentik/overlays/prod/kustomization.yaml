apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: prod-auth
resources:
  - ../../base
  - external-secret.yaml

helmCharts:
  - name: authentik
    repo: https://charts.goauthentik.io
    version: "2025.10.2"
    releaseName: authentik
    namespace: prod-auth
    includeCRDs: true
    valuesFile: values-prod.yaml

patches:
  - target:
      kind: HTTPRoute
      name: http-authentik
    path: httproute-patch.yaml
  - target:
      group: gateway.networking.k8s.io
      version: v1beta1
      kind: ReferenceGrant
      name: allow-routes-to-shared-outpost
    path: reference-grant-patch.yaml
